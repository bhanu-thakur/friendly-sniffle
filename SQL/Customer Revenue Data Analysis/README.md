
## Sales Data EDA Assignment by AnalytixLabs Noida
```
Q15	For all customers aged between 25 to 35 years find what is the net total revenue
    generated by these consumers in last 30 days of transactions from max transaction
    date available in the data?
```

```sql
select ROUND(SUM(total_amt), 2) as Required_Revenue
-- 1C Starts. Here, further WHERE is applied to filter transactions that took place in last 1 month using BETWEEN
from (
select * -- 1B Starts. It returns original table as-it-is for further filteration.
from (
select *
from Transactions as T
left join Customer as C on T.cust_id = c.customer_Id
-- BLOCK 1A Starts
-- This code feeds the column that inner query has returned
where customer_Id IN
(
--  This query inside where will return a column that contains only IDs of customers whose age is b/w 25 and 30
    select customer_Id
    from (
    select *
    from Customer
    where
    	DATEDIFF(year, DOB, (Select MAX(tran_date) from Transactions) ) > 24 
    	AND 
	DATEDIFF(year, DOB, (Select MAX(tran_date) from Transactions) ) < 36
    ) as t
	) -- BLOCK 1A Ends
) as t2 -- 1B Ends
WHERE 
	tran_date BETWEEN DATEADD(month, -1, (Select MAX(tran_date) from Transactions)) 
	AND 
	(Select MAX(tran_date) from Transactions) -- 1C filteration
) as t3 -- 1C ends
```
  
>Output


| Required_Revenue |
|------------------|
| 494023.4         |





```
Q14 What is percentage of sales and returns by product sub category; display only top 5 sub categories in terms of sales
```

```sql
-- another way to solve without joins is by calculating columns required in the Select statement only.

select * --Outer most select starts
from (
-- Left join is performed on t1.prod_subcat where t1 is table 1 (t1) and then it's prod_subcat is used to perform JOIN
select
t1.prod_subcat AS 'Top 5 Sub Categories in Terms of Sales', 
Total_Sales, 
Percentage_Sales,
Total_Returns,
Percentage_Returns
from (
--  1A starts To get top 5 catgories by Total Sales
SELECT TOP 5
		prod_subcat,
		ROUND(SUM(total_amt), 2) as 'Total_Sales',
		ROUND((SUM(total_amt)/(select(SUM(total_amt)) from Transactions)*100), 2) AS 'Percentage_Sales'
FROM Transactions AS T
LEFT JOIN prod_cat_info AS P
ON T.prod_cat_code = P.prod_cat_code
AND T.prod_subcat_code = P.prod_sub_cat_code
where total_amt > 0
GROUP BY prod_subcat
ORDER by Total_Sales DESC
 --1A ends
) as t1
left join (
-- 1B starts to calculate percentage returns
SELECT
		prod_subcat,
		ROUND(SUM(total_amt), 2) as 'Total_Returns',
		Round(ABS((SUM(total_amt)/(select(SUM(total_amt)) from Transactions)*100)), 2) AS 'Percentage_Returns'
FROM Transactions AS T
LEFT JOIN prod_cat_info AS P
ON T.prod_cat_code = P.prod_cat_code
AND T.prod_subcat_code = P.prod_sub_cat_code
where total_amt < 0
GROUP BY prod_subcat
--1B ends
) as t2
ON t1.prod_subcat = t2.prod_subcat
) as t3 -- Outermost select ends
```
  
>Output


| Top 5 Sub Categories in Terms of Sales | Total_Sales | Percentage_Sales | Total_Returns | Percentage_Returns |
|----------------------------------------|-------------|------------------|---------------|--------------------|
| Women                                  | 7020080.41  | 14.45            | -852897.7     | 1.76               |
| Mens                                   | 6905870.83  | 14.22            | -733517.85    | 1.51               |
| Kids                                   | 4806698.53  | 9.89             | -550611.65    | 1.13               |
| Mobiles                                | 2508648.57  | 5.16             | -259945.77    | 0.54               |
| Fiction                                | 2492901.17  | 5.13             | -260650.73    | 0.54               |





```
Q13  Which store-type sells the maximum products; by value of sales amount and by quantity sold?
```

```sql
select 'Maximum Sales is from the store : ' AS 'Description', * 
from (select TOP 1 * from (select Store_type, ROUND(SUM(total_amt), 0) as 'Total'
FROM Transactions
WHERE total_amt > 0
GROUP BY Store_type) AS t
Order by Total DESC) as t2
UNION ALL
select 'Maximum Quantity overall is from the store : ',*
from (select TOP 1 * from (select Store_type, SUM(Qty) as 'Total'
FROM Transactions
GROUP BY Store_type) AS a
Order by Total DESC)a2
```
  
>Output


| Description                                  | Store_type | Total    |
|----------------------------------------------|------------|----------|
| Maximum Sales is from the store :            | e-Shop     | 22185613 |
| Maximum Quantity overall is from the store : | e-Shop     | 22763    |





```
Q12  Which product category has seen the max value of returns in the last 3 months of transactions?
```

```sql
Select top 1 * from
(
SELECT prod_cat AS Category, ROUND(sum(total_amt), 2) as Total_Returns
--SELECT TOP 1 prod_cat AS Category, ROUND(sum(total_amt), 2) as Total_Returns
FROM Transactions AS T
LEFT JOIN prod_cat_info AS P ON T.prod_cat_code = P.prod_cat_code
AND T.prod_subcat_code = P.prod_sub_cat_code
WHERE
total_amt<0 AND tran_date BETWEEN DATEADD(month, -3, (Select MAX(tran_date) from Transactions))
AND 
(Select MAX(tran_date) from Transactions)
GROUP BY prod_cat
--ORDER BY Total_Returns
) as t
ORDER BY Total_Returns
```
  
>Output


| Category | Total_Returns |
|----------|---------------|
| Books    | -134408.9     |





```
Q11 Find the average and total revenue by each subcategory for the categories which are among top 5 categories in terms of quantity sold.
```

```sql
SELECT prod_cat,prod_subcat,
ROUND(AVG(total_amt), 2) AS 'Average_Revenue',
ROUND(SUM(total_amt), 2) as 'Total_Revenue'
FROM Transactions AS T
LEFT JOIN prod_cat_info AS P ON T.prod_cat_code = P.prod_cat_code
AND T.prod_subcat_code = P.prod_sub_cat_code
WHERE prod_cat IN
(

SELECT prod_cat FROM
(
SELECT TOP 5 prod_cat,SUM(Qty) AS 'Quantity_Sold'
FROM Transactions AS T
LEFT JOIN prod_cat_info AS P ON T.prod_cat_code = P.prod_cat_code
AND T.prod_subcat_code = P.prod_sub_cat_code
WHERE Qty>0
GROUP BY prod_cat
ORDER BY Quantity_Sold DESC

) AS Top_category_by_Quantity
)

GROUP BY prod_cat,prod_subcat
ORDER BY prod_cat
  ```
  
>Output


| prod_cat         | prod_subcat         | Average_Revenue | Total_Revenue |
|------------------|---------------------|-----------------|---------------|
| Books            | Academic            | 2125.49         | 2055344.43    |
| Books            | Children            | 2136.67         | 2211451.18    |
| Books            | Comics              | 2037.68         | 2100848.41    |
| Books            | DIY                 | 2108.37         | 2085180.6     |
| Books            | Fiction             | 2140.22         | 2232250.44    |
| Books            | Non-Fiction         | 2129.1          | 2137620.47    |
| Clothing         | Kids                | 2136.6          | 2110960.06    |
| Clothing         | Mens                | 2128.26         | 2058030.8     |
| Clothing         | Women               | 2071.79         | 2082147.33    |
| Electronics      | Audio and video     | 2247.96         | 2140058.1     |
| Electronics      | Cameras             | 2165.88         | 2133390.59    |
| Electronics      | Computers           | 2181.75         | 2090116.61    |
| Electronics      | Mobiles             | 2181.09         | 2248702.79    |
| Electronics      | Personal Appliances | 2170.98         | 2110196.56    |
| Footwear         | Kids                | 2125.99         | 2145126.81    |
| Footwear         | Mens                | 2112.06         | 1989564.94    |
| Footwear         | Women               | 1989.58         | 2085083.38    |
| Home and kitchen | Bath                | 2059.85         | 2107226.39    |
| Home and kitchen | Furnishing          | 2084.01         | 2098595.35    |
| Home and kitchen | Kitchen             | 2008.96         | 2083289.92    |
| Home and kitchen | Tools               | 2024.37         | 2149882.8     |




```
Q10 What are the categories for which average revenue is above the overall average
```
```sql
SELECT prod_cat, ROUND(AVG(total_amt), 2) AS 'Average_Revenue'
FROM Transactions AS T
LEFT JOIN prod_cat_info AS P ON T.prod_cat_code = P.prod_cat_code
AND T.prod_subcat_code = P.prod_sub_cat_code
GROUP BY prod_cat
Having AVG(total_amt) > (select ROUND(AVG(total_amt), 2)
from Transactions AS T
LEFT JOIN prod_cat_info AS P ON T.prod_cat_code = P.prod_cat_code
AND T.prod_subcat_code = P.prod_sub_cat_code)
ORDER BY Average_Revenue DESC
```
  
>Output


| prod_cat    | Average_Revenue |
|-------------|-----------------|
| Electronics | 2189.15         |
| Books       | 2112.82         |
| Clothing    | 2111.87         |






```
Q9 What is the total revenue generated from “Male” customers in “Electronics” category? Output should display total revenue by prod sub-cat.
```

```sql
select  prod_cat, prod_subcat,
		ROUND(SUM(total_amt), 2) AS Total_Revenue

FROM Transactions AS T
	LEFT JOIN prod_cat_info AS P ON T.prod_cat_code = P.prod_cat_code
	AND T.prod_subcat_code = P.prod_sub_cat_code

	LEFT JOIN Customer AS C ON C.customer_Id = T.cust_id
WHERE p.prod_cat = 'Electronics' AND C.Gender = 'M'
GROUP BY prod_cat, prod_subcat
ORDER BY Total_Revenue DESC;
```
  
>Output


| prod_cat    | prod_subcat         | Total_Revenue |
|-------------|---------------------|---------------|
| Electronics | Mobiles             | 1192413.25    |
| Electronics | Cameras             | 1172702.34    |
| Electronics | Audio and video     | 1138983.19    |
| Electronics | Personal Appliances | 1107593.5     |
| Electronics | Computers           | 1091417.54    |





```
Q8 What is the combined revenue earned from the “Electronics” & “Clothing” categories, from “Flagship stores”?
```

```sql
SELECT 
	--prod_cat,
	'Combines Revenue is =',
	sum(total_amt)

FROM prod_cat_info AS p
LEFT JOIN Transactions AS t
	ON p.prod_cat_code = t.prod_cat_code
	AND p.prod_sub_cat_code = t.prod_subcat_code
WHERE
	prod_cat IN ('Electronics', 'Clothing') AND Store_type = 'Flagship Store'
```
  
>Output


| Combines Revenue is = 3409559.52 | prod_subcat |
|----------------------------------|-------------|





```
Q7 How many customers have >10 transactions with us, excluding returns?
```

```sql

SELECT 'Customers with Transactions > 10 excluding returns', COUNT(*) FROM

(
SELECT cust_id, COUNT(cust_id) AS TRANSACTIONS_1
FROM Transactions
WHERE total_amt>0
GROUP BY cust_id
HAVING COUNT(cust_id)>10

) AS sub_table
```
  
>Output


| Customers with Transactions > 10 excluding returns | 6 |
|----------------------------------------------------|---|





```
Q6 What is the net total revenue generated in categories Electronics and Books?
```

```sql
SELECT 
	'Net total revenue is = ',
	ROUND(sum(total_amt), 2)

FROM prod_cat_info
LEFT JOIN Transactions 
	ON prod_cat_info.prod_cat_code = Transactions.prod_cat_code
	AND prod_cat_info.prod_sub_cat_code = Transactions.prod_subcat_code
WHERE prod_cat IN ('Electronics', 'Books')
```
  
>Output


| Net total revenue is = | 23545160.21 |
|------------------------|-------------|





```
Q5 What is the maximum quantity of products ever ordered?
```

```sql
SELECT TOP 1 prod_cat_info.prod_cat, SUM(Qty) AS 'Maximum_Quantity'
FROM Transactions
LEFT JOIN prod_cat_info ON prod_cat_info.prod_cat_code = Transactions.prod_cat_code
and prod_sub_cat_code = Transactions.prod_subcat_code
GROUP BY prod_cat_info.prod_cat
ORDER BY Maximum_Quantity DESC
```
  
>Output


| prod_cat | Maximum_Quantity |
|----------|------------------|
| Books    | 14669            |




```
Q4 How many sub-categories are there under the Books category?
```

```sql
SELECT prod_cat_info.prod_cat, COUNT(prod_cat_info.prod_subcat) AS 'Number of sub categories'
FROM prod_cat_info
WHERE prod_cat_info.prod_cat = 'Books'
GROUP BY prod_cat_info.prod_cat
```
  
>Output


| prod_cat | Number of sub categories |
|----------|--------------------------|
| Books    | 6                        |





```
Q3 From which city do we have the maximum number of customers and how many?
```

```sql
select TOP 1 city_code, count(customer_Id) AS Customers from Customer
GROUP BY city_code
ORDER BY count(city_code) DESC
```
  
>Output


| city_code | Customers |
|-----------|-----------|
| 3         | 595       |





```
Q2 What is the count of Male and Female customers in the database
```

```sql
SELECT Gender, COUNT(GENDER) as 'Total Customers'
FROM Customer
where gender IN ('M', 'F')
GROUP BY Gender
order by [Total Customers] DESC
```
  
>Output


| Gender | Total Customers |
|--------|-----------------|
| M      | 2892            |
| F      | 2753            |





```
Q1 Which channel is most frequently used for transactions
```

```sql
select Channel as 'Most frequently Channel'
from (
select
	Transactions.Store_type AS Channel, 
	COUNT(transaction_id) AS Num_Of_Transactions, 
	ROW_NUMBER() OVER (ORDER BY COUNT(transaction_id) DESC) AS 'Ranking'
from Transactions
GROUP BY Store_type
) as t
where Ranking = 1
```
  
>Output


| e-Shop |
|--------|
